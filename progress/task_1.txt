Задание:
1) прочитать статью с хабра (туториал по аплифт) https://habr.com/ru/company/ru_mts/blog/485980/
2) посмотреть видео по ссылкам оттуда
3) из списка литературы этой статьи прочитать статью [4] : 
   Nassif, Houssam & Kuusisto, F. & Burnside, Elizabeth & Shavlik, J… (2014). 
   Uplift modeling with ROC: An SRL case study. CEUR Workshop Proceedings.
4) по этой статье [4] подготовить выжимки


Обозначения:
[4] -- статья из списка литературы первой части статьи с хабра
остальные номера указаны для статей из списка литературы уже из [4] с хабра
сп.лит. = список литературы



Что сделал: 
1) прочитал три части статьи с хабра, посмотрел видео из ссылок внизу
2) прочитал [4] из сп.лит хабра
3) из сп.лит. [4]: прочел [9]
4) из сп.лит. [4]->[9]:
       начал P. D. Surry and N. J. Radcliffe, 2011. Quality measures for uplift models. submitted to KDD2011




Понятия из статьи [4] с хабра (+ разобрался, - нет, +- надо повторить разок):
 1) +  uplift, uplift моделирование
 2) +- Lift score
 3) +  uplift curve [9]
 4) -  SAYL (score as you lift) [6]
 5) -  rule-learners
 6) -  inductive logic programming (ILP)
 7) -  statistical relational learning (SRL)
 8) -  SAYU [1]
 9) -  TAN classifiers [2]
10) -  Bayes net
11) -  Differential Prediction Search (DPS) and Model Filtering (MF) methods [7]
12) -  return-on-investment (ROI) [9]
13) +- CART метод разбиения в решающем дереве [9]


Выжимки из [4] с хабра:
1) что хотели: в задаче аплифт моделирования в алгоритме SAYL работать не с lift curve, а ROC curve и оптимизировать
   разницу именно в площади между кривыми ROC для целевой и контрольной групп и посмотреть, что получится при попытке
   максимизации числа объектов положительного класса
2) какие данные использовали: датасет маммограмм (сканов грудной клетки) у молодых (контрольная группа) и более
   возрастных пациентов (целевая группа), где положительный класс имеет "in situ cancer" (опухоль в зародыше),
   а отрицательный класс имеет "invasive cancer" (сильно распространившаяся)
3) как тренировали и валидировали модель: 10 глобальных фолдов, 10 глобальных запусков, в каждом запуске сначала подбирали
   лучшие параметры по отдельной кросс-валидации на датасете из 9 глобальных фолдов, а затем уже смотрели на качество на 1
   глобальном фолде при использовании лучших параметров (выбирали лучшую модель и смотрели ее скор)
   и так делали для ROC AUC и Lift AUC
4) что получили:  ROC показала себя немного лучше на долях маммограмм от 0.5 до 0.8, но в целом не сильно лучше Lift,
   использовали тест Манна-Уитни на 95% для проверки в различии качества моделей, который не показал заметных различий 
   в использовании этих двух метрик, при этом они обе сделали алгоритм SAYL заметно лучше других методов (бейзлайн, 
   Model Fitering (MF), ifferential Prediction Search (DPS))
   однако, модель, полученная с использованием ROC кривой, имела в среднем 24.7 правил, в то время как использование
   lift кривой давало 9.3 правил в среднем, то есть модель с ROC кривой менее интерпретируема при несильно лучших результатах




Статья [9] (про аплифт моделирование в общем) -- выжимки:
раздел 4.3 (Success Criteria and Goals) -- перечитать
1) в чем плохи были старые методы моделирования эффективности маркетинговых ходов?
   признавали, что надо изучать эффект постепенно, аккуратно исследуя прирост дохода
   как следствие действий, но при этом не говорилось об исследовании эффекта в зависимости
   от рассматриваемой "target population";
   и каждый тип моделей (penetration (or lookalike) models, purchase models, response models) 
   моделировал не эффект от действия (изменение поведения покупателя), а само поведение покупателя
   (они показывают, что покупатель решил купить наш товар, а не эффект нашей рекламы)
2) хотим модель, которая предсказывает именно эффект от взаимодействия с пользователем, чтобы не
   трогать тех, кто и так купит товар или услугу, чтобы не тратить на них наши ресурсы
3) response модель ... этот термин может ввести в заблуждение, его надо использовать осторожно, ведь
   такие модели не настолько хороши, чтобы на них полагаться в маркетинге
   она учится предсказывать вероятность покупки пользователя из целевой группы (ни слова о контрольной)
   аплифт модель предсказывает P{покупки чел-ом, если из целевой} - P{покупки чел-ом, если из контрольной}
4) оценивать производительность uplift моделей непросто, но неплохое начало -- incremental gains curves,
   но немного другие (incremental показывают cumulative incremental impact, а обычные gains curves 
   показывают cumulative raw outcome, то есть вместо delta(f) они показывают само значение f)
5) аплифт не является аддитивной величиной, например, если отранжировать выборку, разбить по среднему
   значению ранжирующего параметра, а затем посчитать на двух получившихся выборках аплифт отдельно, то
   взвешенное среднее этих аплифтов не будет равно аплифту по всей выборке
6) одна из лучших метрик для аплифт моделей -- qini curve, но как вообще оценить качество такой модели,
   ведь в традиционных моделях используются метрики для сравнения истинных ответов с предсказанными, но
   тут мы предсказыавем аплифт -- чистый эффект от взаимодействия с пользователем, который означает 
   измерение желания человека купить товар ПРИ взаисодействии с ним И БЕЗ взаимодействия с ним ... это
   два несовместных события, поэтому мы не можем сравнить предсказание с РЕАЛЬНЫМ аплифтом, так как его
   попросту нет
   ПРЕДЛАГАЮТ: для хоть сколько-то жизнеспособной модели для каждого сегмента выборки (мы ведь можем
   разделить по предсказанному аплифту поделить людей на группы по диапазонам аплифта) стараться делать
   не очень простые предсказания (предсказать просто среднее по сегенту нельзя -- не гарантирует успеха)
   надо делать "набор разных предсказаний" (НАДО ПОДЧИТАТЬ, стр 13, середина)
       возможно, имеется это: если значения похожи, то по сути мы не смогли выцепить группы людей, которые
       наиболее подвержены воздействию, мы просто получаем со всех какой-то прирост прибыли, но главных
       целей так и не нашли, а вот если предсказания аплифта довольно разнообразные, то по идее модель
       смогла найти тех, на ком не особо можно заработать, и тех, на ком наоборот заработать можно хорошо
   НА ЧТО СМОТРЯТ ПРИ ВАЛИДАЦИИ АПЛИФТ МОДЕЛЕЙ: на qini, на отсортированные по предсказанному аплифту 
   данные, на максимально достиагемый профит, на профит по точке отсечение (топ 40% по отранжированным),
   насколько данные из валидации близки к тренировочным (на других данных и ошибки будут больше),
   на различие предсказаний по сегментам (чем больше отличия, тем лучше модель ... ПОЧЕМУ ?)
7) основные подходы к моделировани.
      разность предсказаний двух моделей -- в идеальном мире работает идеально, на практике плохо
          не предсказывают чистый эффект, предсказывают вероятность покупки в 2 случаях отдельно
          модели концентрируются на главных факторах, которые общие для 2 групп, не учитывая различия
          работают отдельно, поэтому выделяют фичи, поелезные именно для их задачи (покупки товара при ...)
              но не смотрят на фичи, ключевые для повышения интереса к товару (они мб вообще другими)
          ошибки двух независимых моделей могут дать вместе грустный итог, строго показать сложно
8) основное : The Significance-Based Uplift Tree
   важные замечания:
       размер контрольной группы обычно меньше целевой
       аплифт -- "a second-order phenomenon", поэтому ошибки в оценке его величины обычно довольно велики
       сам аплифт эффект обычно небольшой ... очень ... например, если основные доли продаж в целевой и контрольной
       группах составляют 1.0% и 1.1%, то понятно, что аплифт примерно 0.1pp (процентных пункта), поэтому важно, что
       моделировать стоит "стабильно"
   поскольку с одним человеком нельзя одновременно прокоммуницировать и не сделать этого, то измерить реальный
       аплифт для отдельного человека нельзя, поэтому используют оценки по целым группам людей, а решающие деревья
       как раз работают с группами объектов, разбивая их на две подгруппы в каждом своем узле, поэтому для прямого
       предсказания аплифта (а не как в случае 2 независимых моделей двух скоров) они подходят интуитивно лучше
   подход основан на 4 пунктах: 
       the signficance-based splitting criterion
       variance-based pruning (сначала растим дерево, затем пруним: ценность сплитов видна лишь после полного построения)
       use of bagging
       pessimistic qini-based variable selection
   как валидировать аплифт модели на деревьях:
       бутстрапируем N (обычно 8-10-20) выборок из изначальной
       выделяем одну для тренировки модели
       на остальных ввалидируем модель и смотрим на ее стабильность на разных выборках
9) также важным моментом является отбора признаков, которые будут участвовать в обучении модели, ведь иногда это
   может довольно сильно улучшить результаты, но в некоторых моделях, как ни странно, это не имеет большого значения,
   особенно в моделях на основе деревьев
   основные причины (мотивации) отбора признаков :
       уменьшение размерности пространства признаков и склонности к переобучению
       удаление коррелирующих признаков
       повышение качества модели и ее стабильности (для аплифта это на 1 плане: переобучение тут сильнее и чаще есть)
       повышение интерпретируемости
   в аплифт моделировании вообще, похоже, очень часто модели без выбора признаков просто проваливаются на валидации
10) резюме "когда стоит использовать аплифт моделирование": почти всегда ... ? (я читать не умею ... плак-плак ... кто-нить переведите ...)
        либо даст лучшие результаты из возможных (как в теории)
        либо даст рещультаты, которые будут оправдывать затраченные усилия
    чек-лист для понимания, нужно ли использовать аплифт моделирование:
        наличие качественной контрольной группы (если ее нет ... то сначала надо найти)
        объем выборки -- контрольная в 10 раз больше выборки, используемой для оценки качества, а также 500 <= (uplift)*(control set size)
        наличие негативных эффектов -- какая-то группа клиентов и так не очень довольна производителем, у них отрицательный аплифт, надо ловить это
        используемые виды коммуникаций -- их число, их типы, группы людей для коммуникации такими способами (если способов много, есть риск ошибиться)
        корреляция аплифта и значения выгоды (аплифт растет и прибыль растет или, наоборот, они антикоррелированы, и тогда традиционная модель будет 
            расценивать худших как лучших для коммуникации клиентов)
        общий эффект от коммуникации и известность бренда -- хороший бренд не должен спамить постоянного клиента, а вот малоизвестный любому рад, даже
            не нужна аплифт модель, хватит response-модели, потому что там любой покупатель с большой вероятностью пришел именно из-за коммуникации
        







Статья из сп.лит. [4]->[9]
P. D. Surry and N. J. Radcliffe, 2011. Quality measures for uplift models. submitted to KDD2011.
1)
2)
3)
4)
5)
6)
7)
8)
9)







Вопросы:
1) Отличие Response и Uplift моделей ?
   Response : всегда есть взаимодействие с клиентом, смотрим что будет 
              (ищем вероятность эффекта воздействия)
   Uplift   : сравниваем две ситуации для клиента, когда есть и нет взаимодействия 
              (наблюдаем разницу, то есть чистый эффект от воздействия, ищем подверженных влиянию;
               одновременно действие присутствовать и отсутствовать не может, поэтому две группы:
               целевая и контрольная, на контрольной воздействие не применяем)

2) Когда применять Response и Uplift модели ?
   Uplift   : смотрим на чистый эффект взаимодействия с клиентом, хотим найти тех, кто
              откликнется при взаимодействии, но не откликнется при его отсутствии
              если таких людей много, то можно заметно увеличить продажи продукта, если
              коммуницировать с дополнительной группой клиентов (которых ищем),   
      ???     при этом товар должен быть популярным
   Response : когда товар не очень популярный, то важно, откликнется ли кто-нибудь вообще,
              если мы расскажем о товаре, то есть хочется оценить вероятность покупки
              клиентом продукта при его рекламе

3) Почему на схеме с выборками из статьи на хабре на переходе от сбора данных к моделированию
   uplift в обучающую и тестовую выборки попадают люди как из контрольной группы, так и из целевой ?
   Контрольная группа -- та, на котрую нет воздействия.
   Целевая -- на которую есть.
   Чтобы обучить модель, нужны как те, так и другие. Это разбиение происходит изначально, до всех
   этапов разработки моделей, чтобы выделить тех, кому отправлять смс, кому нет.

4) В чем отличие пайплайна обучения uplift модели от обычной модели?
   Таргет имеется не сразу. Сначала получаем данные, делим случайно на тех, с кем будем коммуницировать,
   и тех, с кем не будет, затем запускаем пилот и принимаем реакцию пользователей, которая и станет
   нужным нам для обучения таргетом (таргет будет для обеих групп пользователей по признаку наличия
   коммуникации

5) Uplift curve : почему baseline именно так выглядит (прямая линия от 0 до 100% и по оси ординат до 
   некоторого значения, что это за значение, почему в эту же точку приходят все модели)? 
   Мысли: 
	есть множество людей, выбрали, на кого будем воздействовать (некоторую долю людей)
 	по оси абсцисс откладываем эту долю людей, с которыми прокоммуницировали
	при коммуникации с какой-то долей людей у нас как-то выросли продажи (к примеру)
	если рандомно коммуницировать, то ожидать по идее можно линейного роста прироста продаж (именно так как написано)
		то есть шансы поскольку одинаковые (попасть на любой из типов пользователей), то и рост аплифта линейный
	поэтому baseline (рандомная коммуникация) линейно растет от нуля до количества дополнительных продаж,
		которое получилось бы, если бы мы обзвонили (или отправили смс) всем клиентам
		причем важно, что все эти числа -- оценочные
	с помощью аплифт модели мы выбираем более умным способом клиентов, которых "трогать"
		мы их ранжируем по аплифту (росту склонности к покупке после взаимодействия с ними)
		выбираем долю покупателей (по сути, отранжировали и взяли топ N% клиентов)
		раз они отсортировани по убыванию "приоритета", то теперь среди топ 30% (например)
		находится куда больше склонных к покупке клиентов, то есть если их мы обзвоним, то
		получим заметно больше дополнительных продаж, чем в случае рандомного обзванивания
		отсюда и получается, что кривая аплифт модели выше диаогнали рандомного обзванивания
	поскольку с ростом доли взятых из изначальной (пусть и отранжированной уже) выборки клиентов
		мы приближаемся к 100% (всем клиентам), то тут уже становится неважно, отранжировали
		мы клиентов или нет ... мы все равно обзвоним их почти всех, это будет имитация
		бурной жизнедеятельности (почти всех обзвонили ... это все равно что просто всех обзвонить)
		поэтому получим мы при применений любой модели, если взять долю клиентов 100%, такой
		же результат, как при применении baseline

---) Как проводить стратификацию групп клиентов ? Стоит ли применять алгоритмы кластеризации для
   первичного выделения групп похожих клиентов с целью разделения уже полученных небольших групп
   на контрольную и целевую для каждой кагорты клиентов, чтобы уже затем смотреть, как работает 
   воздействие на них. Так как они похожи, то можно будет лучше понять необходимый тип взаимодействия.

6) Что такое zero-downlift incremental gain curve ([9] из [4] с хабра) ? Что значит нет негативных эффектов ?
   В статье была фраза "Negative effects arise when, for some or all segments of the population, the overall 
   impact of the treatment is to reduce sales."
   Перевод: "Негативные эффекты возникают, когда для некоторых или всех слоев населения общий эффект воздействия
   заключается в снижении продаж."
   







Словарик:
assess accuracy -- оценить точность
seminal work -- основополагающая работа
patterns gleaned from the data -- закономерности, выявленные на основе данных
devote -- посвяащать (главы книги чему-то, например)
conventional models -- традиционные модели
worthwhile extra value -- некоторый эффект (профит), стоящий усилий
they come under the general umbrella -- идут под общим названием, можно назвать одним термином
‘propensity modelling’ -- 'моделирование склонности'
customer retention -- удержание клиентов
acquisition -- приобретение
churn -- отток
attrition -- отсев
retain -- сохранить
subsidiary goals -- вспомогательные цели
revenue -- доход
undertaken -- предпринято
for clarity of exposition -- для ясности изложения
recognition -- признание (кем-то какого-то факта или получение уважения кем-то)
perversely -- ошибочно
we reject it as flawed -- ... как несовершенное
marketing intervention -- маркетинговое воздействие
it is worth singling out -- стоит выделить
incentive -- стимул
impediment -- препятствие
deliberately -- преднамеренно
henceforth -- отныне
tackling -- решение проблемы
they outlined their approach -- обрисовали в общих чертах
prior to -- до
the activity was marginal -- активность была незначительной
it is subject to error -- он подвержен ошибкам
notion of dominance -- понятие доминирования
Notwithstanding -- Несмотря на то, что
outperform -- превзойти
outline -- очертить или набросать контур (гл.), набросок (сущ.)
it is doomed to failure -- она обречена на провал
arbitrary -- произвольный
it is intimately linked to -- это тесно связано с
triangular gains curve -- треугольная кривая усиления
slope -- наклон (у графика -- производная)
to rank A ahead of B -- ставить A перед B
it is compromised by -- находится под угрозой
sufficient -- достаточно (для того чтобы ...)
picking cut-off points -- выбор точки отсечения
i.e. -- то есть
the model has any utility -- модель имеет хоть какую-то полезность
for reasonably large segments -- для достаточно крупных сегментов
it is inherent in ... -- присущий чему-то
inherently larger errors -- неизбежно (изначально) большие погрешности
exploitable advantage -- полезное преимущество
it is capable of being represented very simply -- мб представлено ...
deliberately -- умышленно, преднамеренно, сознательно
plausible -- правдоподобный
whereby -- при этом, в связи с чем, таким образом
it goes to the fore -- выходит на первый план
the impact is modest -- эффект оказался скромным (слабым..?)
justify -- обосновывать, оправдывать (усилия не были оправданы результатом)
intrusive -- назойливый, навязчивый
it may well be misled -- он вполне может быть введен в заблуждение
germane words -- важные слова
this period spanned a decade -- охватывал, длился



https://www.kaggle.com/datasets/arashnic/uplift-modeling

